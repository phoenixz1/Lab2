import java.net.*;
import java.io.*;
import java.util.*;


public class ServerExecutionThread extends Thread {
	
 	public int tID;	
	private Queue<MazewarPacket> inQueue;
	private Map<Integer, MazewarServerHandlerThread> clients;
	
	public ServerExecutionThread
			(int tID, Queue<MazewarPacket> incomingQueue, Map<Integer, MazewarServerHandlerThread> clients) 
	
	{
		super("MazewarServerHandlerThread");
		this.tID = tID;
		this.inQueue = incomingQueue;
		this.clients = clients;
		System.out.println("Created new ExecutionThread; tID = "+ tID);
	}
	
	

	// keep checking if queue is not empty (polling/timer interrupts)
	// deque packet
	// process packet (handle fire event here)
	// broadcast to clients
	public void run() {
		while(true){
			if(inQueue.size() > 0) {
				System.out.println("Executing packet");
				MazewarPacket top = inQueue.remove();
				broadcast(top);
			}
		}
	}

	// update the queue
	public void broadcast(MazewarPacket currPacket) {

		Set<Integer> s = clients.keySet();
		for(int tid : s) {
			MazewarServerHandlerThread t = clients.get(tid);
       			t.send(currPacket);
 		}
	}


};
